{% extends 'base.html' %}

{% block title %}AI Content Curator - Intelligent Content Analysis{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="text-center mb-12">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight">
      Intelligent Content <span class="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Analysis</span>
    </h1>
    <p class="text-xl text-gray-600 mb-8 leading-relaxed">
      Analyze individual articles or curate entire topics with AI-powered insights. 
      Get comprehensive quality scores, sentiment analysis, and relevance metrics.
    </p>
    <div class="flex flex-wrap justify-center gap-6 text-sm text-gray-500">
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-bolt text-yellow-500"></i>
        <span>Lightning Fast</span>
      </div>
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-shield-check text-green-500"></i>
        <span>Reliable Analysis</span>
      </div>
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-chart-line text-blue-500"></i>
        <span>Professional Results</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Interface -->
<div class="max-w-6xl mx-auto">
  <div class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden">
    <!-- Tab Navigation -->
    <div class="border-b border-gray-200 bg-gray-50">
      <nav class="flex">
        <button class="tab-btn active flex-1 px-6 py-4 text-center font-medium transition-all duration-200" data-tab="analyze">
          <div class="flex items-center justify-center gap-3">
            <i class="fa-solid fa-magnifying-glass-chart text-lg"></i>
            <span>Analyze Article</span>
          </div>
        </button>
        <button class="tab-btn flex-1 px-6 py-4 text-center font-medium transition-all duration-200" data-tab="curate">
          <div class="flex items-center justify-center gap-3">
            <i class="fa-solid fa-layer-group text-lg"></i>
            <span>Curate Topic</span>
          </div>
        </button>
      </nav>
    </div>

    <!-- Analyze Panel -->
    <div class="tab-panel p-8" id="panel-analyze">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Article Analysis</h2>
        <p class="text-gray-600">Extract comprehensive insights and compute quality scores for any article.</p>
      </div>

      <form id="analyze-form" class="space-y-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="space-y-2">
            <label for="analyze-url" class="block text-sm font-medium text-gray-700">Article URL</label>
            <input type="url" id="analyze-url" class="form-input" placeholder="https://example.com/article" required>
          </div>
          <div class="space-y-2">
            <label for="analyze-query" class="block text-sm font-medium text-gray-700">Query (optional)</label>
            <input type="text" id="analyze-query" class="form-input" placeholder="e.g., artificial intelligence">
          </div>
        </div>

        <div class="flex items-center space-x-3">
          <input type="checkbox" id="use-embeddings" class="form-checkbox">
          <label for="use-embeddings" class="text-sm text-gray-700">Use semantic relevance (embeddings)</label>
        </div>

        <div class="flex items-center space-x-4">
          <button type="submit" class="btn-primary">
            <i class="fa-solid fa-chart-line"></i>
            <span>Analyze Article</span>
          </button>
          <div id="analyze-loading" class="hidden flex items-center space-x-2 text-blue-600">
            <div class="animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"></div>
            <span class="text-sm">Analyzing...</span>
          </div>
        </div>

        <div id="analyze-error" class="hidden alert-error"></div>
      </form>

      <!-- Results Card -->
      <div id="analyze-result-card" class="hidden mt-8">
        <div class="result-card">
          <div class="flex items-start justify-between mb-6">
            <div class="flex-1">
              <h3 id="an-title" class="text-xl font-bold text-gray-900 mb-2"></h3>
              <p id="an-meta" class="text-sm text-gray-600"></p>
            </div>
            <div class="score-badge-large" id="an-overall"></div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
            <div class="metric-card">
              <div class="flex justify-between items-center mb-2">
                <span class="metric-label">Readability</span>
                <span id="an-readability-v" class="metric-value"></span>
              </div>
              <div class="progress-bar">
                <div id="an-readability" class="progress-fill bg-blue-500"></div>
              </div>
            </div>
            <div class="metric-card">
              <div class="flex justify-between items-center mb-2">
                <span class="metric-label">NER Density</span>
                <span id="an-ner-v" class="metric-value"></span>
              </div>
              <div class="progress-bar">
                <div id="an-ner" class="progress-fill bg-green-500"></div>
              </div>
            </div>
            <div class="metric-card">
              <div class="flex justify-between items-center mb-2">
                <span class="metric-label">Sentiment</span>
                <span id="an-sentiment-v" class="metric-value"></span>
              </div>
              <div class="progress-bar">
                <div id="an-sentiment" class="progress-fill bg-orange-500"></div>
              </div>
            </div>
            <div class="metric-card">
              <div class="flex justify-between items-center mb-2">
                <span class="metric-label">Relevance</span>
                <span id="an-tfidf-v" class="metric-value"></span>
              </div>
              <div class="progress-bar">
                <div id="an-tfidf" class="progress-fill bg-purple-500"></div>
              </div>
            </div>
            <div class="metric-card">
              <div class="flex justify-between items-center mb-2">
                <span class="metric-label">Recency</span>
                <span id="an-recency-v" class="metric-value"></span>
              </div>
              <div class="progress-bar">
                <div id="an-recency" class="progress-fill bg-pink-500"></div>
              </div>
            </div>
            
            <div class="metric-card">
              <div class="flex justify-between items-center mb-2">
                <span class="metric-label">Reputation</span>
                <span id="an-reputation-v" class="metric-value"></span>
              </div>
              <div class="progress-bar">
                <div id="an-reputation" class="progress-fill bg-teal-500"></div>
              </div>
            </div>
          </div>

          <div id="an-summary" class="prose-content mb-6"></div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="stats-section">
              <h4 class="section-title">Statistics</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">Words:</span>
                  <span id="an-word-count" class="stat-value"></span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Entities:</span>
                  <span id="an-entity-count" class="stat-value"></span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Method:</span>
                  <span id="an-rel-method" class="stat-value">tfidf</span>
                </div>
              </div>
            </div>
            <div id="an-entities" class="hidden entities-section">
              <h4 class="section-title">Entities</h4>
              <div id="an-entities-list" class="entities-list"></div>
            </div>
          </div>

          <div class="flex flex-wrap gap-3">
            <button id="analyze-export-json" type="button" class="btn-secondary">
              <i class="fa-solid fa-file-arrow-down"></i>
              <span>Export JSON</span>
            </button>
            <button id="analyze-export-csv" type="button" class="btn-secondary">
              <i class="fa-solid fa-table"></i>
              <span>Export CSV</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Curate Panel -->
    <div class="tab-panel hidden p-8" id="panel-curate">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Topic Curation</h2>
        <p class="text-gray-600">Fetch, analyze, and rank multiple articles for comprehensive topic coverage.</p>
      </div>

      <form id="curate-form" class="space-y-6">
        <div class="space-y-2">
          <label for="curate-topic" class="block text-sm font-medium text-gray-700">Topic Keywords</label>
          <input type="text" id="curate-topic" class="form-input" placeholder="e.g., climate change, artificial intelligence" required>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="space-y-2">
            <label for="curate-max" class="block text-sm font-medium text-gray-700">Max Articles</label>
            <input type="number" id="curate-max" min="1" max="100" class="form-input" placeholder="20">
          </div>
          <div class="space-y-2">
            <label for="curate-sort" class="block text-sm font-medium text-gray-700">Sort By</label>
            <select id="curate-sort" class="form-select">
              <option value="score_desc">Score: High → Low</option>
              <option value="score_asc">Score: Low → High</option>
            </select>
          </div>
          <div class="space-y-2">
            <label for="curate-min-score" class="block text-sm font-medium text-gray-700">Min Score</label>
            <input type="number" id="curate-min-score" min="0" max="100" value="0" class="form-input">
          </div>
        </div>

        <div class="space-y-3">
          <div class="flex items-center space-x-3">
            <input id="curate-diversify" type="checkbox" checked class="form-checkbox">
            <label for="curate-diversify" class="text-sm text-gray-700">Diversify results (deduplicate and limit per domain)</label>
          </div>
          <div class="flex items-center space-x-3">
            <input id="curate-background" type="checkbox" class="form-checkbox">
            <label for="curate-background" class="text-sm text-gray-700">
              Use background processing for large batches (>5 articles)
              <span class="text-xs text-gray-500 block">Recommended for better performance with many articles</span>
            </label>
          </div>
        </div>

        <!-- Advanced Filters -->
        <div class="border-t border-gray-200 pt-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Advanced Filters</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="space-y-2">
              <label for="curate-domain" class="block text-sm font-medium text-gray-700">Domain</label>
              <input id="curate-domain" type="text" class="form-input" placeholder="e.g., bbc.com">
            </div>
            <div class="space-y-2">
              <label for="curate-date-from" class="block text-sm font-medium text-gray-700">From Date</label>
              <input id="curate-date-from" type="date" class="form-input">
            </div>
            <div class="space-y-2">
              <label for="curate-date-to" class="block text-sm font-medium text-gray-700">To Date</label>
              <input id="curate-date-to" type="date" class="form-input">
            </div>
            <div class="space-y-2">
              <label for="curate-word-min" class="block text-sm font-medium text-gray-700">Min Words</label>
              <input id="curate-word-min" type="number" min="0" class="form-input" placeholder="0">
            </div>
            <div class="space-y-2">
              <label for="curate-word-max" class="block text-sm font-medium text-gray-700">Max Words</label>
              <input id="curate-word-max" type="number" min="0" class="form-input" placeholder="0">
            </div>
          </div>
        </div>

        <div class="flex items-center space-x-4">
          <button type="submit" class="btn-primary">
            <i class="fa-regular fa-newspaper"></i>
            <span>Curate Topic</span>
          </button>
          <div id="curate-loading" class="hidden flex items-center space-x-2 text-purple-600">
            <div class="animate-spin rounded-full h-4 w-4 border-2 border-purple-600 border-t-transparent"></div>
            <span class="text-sm">Curating...</span>
          </div>
        </div>

        <div id="curate-error" class="hidden alert-error"></div>
      </form>

      <!-- Results Section -->
      <div class="mt-8">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div class="flex items-center space-x-4">
            <div class="text-sm text-gray-600">
              <span id="curate-count">0</span> results
            </div>
            <div class="flex items-center space-x-2">
              <label for="curate-page-size" class="text-sm text-gray-700">Per page:</label>
              <select id="curate-page-size" class="form-select-sm">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
              </select>
            </div>
          </div>
          <div class="flex items-center space-x-3">
            <input id="curate-search" type="text" placeholder="Search articles..." class="form-input-sm">
            <button id="curate-export-json" type="button" class="btn-secondary-sm">
              <i class="fa-solid fa-file-arrow-down"></i>
              <span class="hidden sm:inline">JSON</span>
            </button>
            <button id="curate-export-csv" type="button" class="btn-secondary-sm">
              <i class="fa-solid fa-table"></i>
              <span class="hidden sm:inline">CSV</span>
            </button>
          </div>
        </div>

        <div class="flex items-center justify-center space-x-3 mb-6">
          <button id="curate-prev" class="btn-pagination" type="button">
            <i class="fa-solid fa-chevron-left"></i>
          </button>
          <span id="curate-page-info" class="text-sm text-gray-600">Page 1 / 1</span>
          <button id="curate-next" class="btn-pagination" type="button">
            <i class="fa-solid fa-chevron-right"></i>
          </button>
        </div>

        <div id="curate-result" class="space-y-4"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.tab-btn');
    const panels = {
      analyze: document.getElementById('panel-analyze'),
      curate: document.getElementById('panel-curate')
    };
    
    function activate(name) {
      tabs.forEach(t => {
        if (t.dataset.tab === name) {
          t.classList.add('active', 'bg-white', 'text-blue-600', 'border-b-2', 'border-blue-600');
          t.classList.remove('text-gray-600', 'hover:text-gray-900');
        } else {
          t.classList.remove('active', 'bg-white', 'text-blue-600', 'border-b-2', 'border-blue-600');
          t.classList.add('text-gray-600', 'hover:text-gray-900');
        }
      });
      
      panels.analyze.classList.toggle('hidden', name !== 'analyze');
      panels.curate.classList.toggle('hidden', name !== 'curate');
    }
    
    tabs.forEach(t => t.addEventListener('click', () => activate(t.dataset.tab)));
    
    // Initialize first tab
    activate('analyze');
  });
</script>
{% endblock %}

