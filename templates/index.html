{% extends 'base.html' %}

{% block title %}AI Content Curator{% endblock %}

{% block content %}
<section class="hero mb-4">
  <h1 class="font-semibold">AI Content Curator</h1>
  <p>Analyze a single article or curate a full topic with clean, readable results.</p>
  <div class="mt-3 meta-row">Fast • Clean • Professional</div>
</section>

<div class="card-surface p-0">
  <div class="tab-nav">
    <button class="tab-btn active" data-tab="analyze">Analyze</button>
    <button class="tab-btn" data-tab="curate">Curate</button>
  </div>
  <div class="tab-panel" id="panel-analyze">
    <div class="mb-3 text-sm" style="color:#475569">Extract signals and compute a composite quality score.</div>
    <form id="analyze-form" class="grid" style="gap:12px">
      <div>
        <label for="analyze-url" class="text-sm" style="color:#334155">Article URL</label>
        <input type="url" id="analyze-url" class="input input-indigo mt-1" placeholder="https://example.com/article" required>
      </div>
      <div>
        <label for="analyze-query" class="text-sm" style="color:#334155">Query (optional)</label>
        <input type="text" id="analyze-query" class="input input-indigo mt-1" placeholder="e.g., artificial intelligence">
      </div>
      <div class="flex items-center gap-3">
        <button type="submit" class="btn btn-primary"><i class="fa-solid fa-chart-line"></i> Analyze</button>
        <span id="analyze-loading" class="hidden text-sm" style="color:#64748b">Analyzing…</span>
      </div>
      <p id="analyze-error" class="hidden rounded-lg border p-3 text-sm" style="background:#fef2f2;color:#991b1b;border-color:#fecaca"></p>
    </form>

    <div id="analyze-result-card" class="mt-5 hidden">
      <div class="list-card">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 id="an-title" class="text-lg font-semibold"></h3>
            <p id="an-meta" class="text-sm" style="color:#64748b"></p>
          </div>
          <div class="badge-score-lg" id="an-overall"></div>
        </div>
        <div class="mt-4 grid" style="gap:12px;grid-template-columns:1fr 1fr;">
          <div>
            <div class="flex justify-between text-xs" style="color:#64748b"><span>Readability</span><span id="an-readability-v"></span></div>
            <div class="progress-rail"><div id="an-readability" class="progress-fill" style="background:#0284c7;width:0%"></div></div>
          </div>
          <div>
            <div class="flex justify-between text-xs" style="color:#64748b"><span>NER Density</span><span id="an-ner-v"></span></div>
            <div class="progress-rail"><div id="an-ner" class="progress-fill" style="background:#059669;width:0%"></div></div>
          </div>
          <div>
            <div class="flex justify-between text-xs" style="color:#64748b"><span>Sentiment (neutrality)</span><span id="an-sentiment-v"></span></div>
            <div class="progress-rail"><div id="an-sentiment" class="progress-fill" style="background:#d97706;width:0%"></div></div>
          </div>
          <div>
            <div class="flex justify-between text-xs" style="color:#64748b"><span>Relevance</span><span id="an-tfidf-v"></span></div>
            <div class="progress-rail"><div id="an-tfidf" class="progress-fill" style="background:#6366f1;width:0%"></div></div>
          </div>
          <div style="grid-column:1/-1">
            <div class="flex justify-between text-xs" style="color:#64748b"><span>Recency</span><span id="an-recency-v"></span></div>
            <div class="progress-rail"><div id="an-recency" class="progress-fill" style="background:#a21caf;width:0%"></div></div>
          </div>
        </div>
        <p id="an-summary" class="mt-4 prose-summary"></p>
        <div id="an-entities" class="mt-3 hidden">
          <h4 class="text-sm font-semibold" style="color:#0f172a;margin-bottom:0.5rem">Entities</h4>
          <div id="an-entities-list" class="flex" style="gap:8px;flex-wrap:wrap"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-panel hidden" id="panel-curate">
    <div class="mb-3 text-sm" style="color:#475569">Fetch, analyze, and rank multiple articles for a topic.</div>
    <form id="curate-form" class="grid" style="gap:12px">
      <div>
        <label for="curate-topic" class="text-sm" style="color:#334155">Topic Keywords</label>
        <input type="text" id="curate-topic" class="input input-sky mt-1" placeholder="e.g., climate change" required>
      </div>
      <div class="grid" style="gap:12px;grid-template-columns:1fr 1fr 1fr;">
        <div>
          <label for="curate-max" class="text-sm" style="color:#334155">Max Articles (optional)</label>
          <input type="number" id="curate-max" min="1" max="100" class="input mt-1">
        </div>
        <div>
          <label for="curate-sort" class="text-sm" style="color:#334155">Sort By</label>
          <select id="curate-sort" class="input mt-1">
            <option value="score_desc">Score: High → Low</option>
            <option value="score_asc">Score: Low → High</option>
          </select>
        </div>
        <div>
          <label for="curate-min-score" class="text-sm" style="color:#334155">Min Score</label>
          <input type="number" id="curate-min-score" min="0" max="100" value="0" class="input mt-1">
        </div>
        <div style="grid-column:1/-1" class="flex items-center gap-2">
          <input id="curate-diversify" type="checkbox" checked style="width:16px;height:16px">
          <label for="curate-diversify" class="text-sm" style="color:#334155">Diversify results (deduplicate near-similar and cap per domain)</label>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button type="submit" class="btn btn-primary"><i class="fa-regular fa-newspaper"></i> Curate</button>
        <span id="curate-loading" class="hidden text-sm" style="color:#64748b">Curating…</span>
      </div>
      <p id="curate-error" class="hidden rounded-lg border p-3 text-sm" style="background:#fef2f2;color:#991b1b;border-color:#fecaca"></p>
    </form>

    <div class="mt-5">
      <div class="flex items-center justify-between gap-3 mb-3">
        <div class="text-sm" style="color:#64748b"><span id="curate-count">0</span> results</div>
        <div class="flex items-center gap-2">
          <label class="hidden sm:block text-xs" style="color:#94a3b8">Search</label>
          <input id="curate-search" type="text" placeholder="Search title…" class="rounded-lg border p-2 text-sm" style="width:260px;border-color:#e2e8f0;background:white" />
        </div>
      </div>
      <div class="flex items-center justify-between gap-3 mb-3">
        <div class="flex items-center gap-2 text-sm">
          <label for="curate-page-size" style="color:#334155">Per page</label>
          <select id="curate-page-size" class="rounded-lg border p-2" style="border-color:#e2e8f0;background:white">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <button id="curate-prev" class="btn btn-secondary px-3 py-1 text-sm" type="button"><i class="fa-solid fa-chevron-left"></i></button>
          <span id="curate-page-info" class="text-xs" style="color:#64748b">Page 1 / 1</span>
          <button id="curate-next" class="btn btn-secondary px-3 py-1 text-sm" type="button"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
      </div>
      <div id="curate-result" class="grid" style="gap:12px"></div>
    </div>
  </div>
</div>

<script>
  (function(){
    const tabs = document.querySelectorAll('.tab-btn');
    const panels = {
      analyze: document.getElementById('panel-analyze'),
      curate: document.getElementById('panel-curate')
    };
    function activate(name){
      tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===name));
      panels.analyze.classList.toggle('hidden', name!=='analyze');
      panels.curate.classList.toggle('hidden', name!=='curate');
    }
    tabs.forEach(t=>t.addEventListener('click', ()=>activate(t.dataset.tab)));
  })();
</script>
{% endblock %}

